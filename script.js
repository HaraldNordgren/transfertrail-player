var clubsByPlayerFull = {
    "Alan Shearer"         : ["Southampton","Blackburn Rovers","Newcastle United"],
    "Andrea Pirlo"         : ["Brescia","Internazionale","Reggina","Brescia","A.C. Milan","Juventus","New York City FC"],
    "Ángel Di María"       : ["Benfica","Real Madrid","Manchester United","PSG"],
    "Anthony Martial"      : ["Lyon","Monaco","Manchester United"],
    "Arjen Robben"         : ["Groningen","PSV Eindhoven","Chelsea","Real Madrid","Bayern Munich"],
    "Arturo Vidal"         : ["Colo Colo","Bayer Leverkusen","Juventus","Bayern Munich"],
    "Ashley Cole"          : ["Arsenal","Crystal Palace","Arsenal","Chelsea","A.S. Roma"],
    "Bacary Sagna"         : ["Auxerre","Arsenal","Manchester City"],
    "Bebé"                 : ["Estrela","Vitoria de Guimaraes","Manchester United","Besiktas","Rio Ave","Pacos de Ferreira","Benfica"],
    "Carlos Tevez"         : ["Boca Juniors","Corinthians","West Ham","Manchester United","Manchester City","Juventus","Boca Juniors"],
    "Cesc Fabregas"        : ["Arsenal","Barcelona","Chelsea"],
    "Clint Dempsey"        : ["New England Revolution","Fulham","Tottenham","Seattle Sounders FC"],
    "Cristiano Ronaldo"    : ["Sporting Cp","Manchester United","Real Madrid"],
    "Dani Alves"           : ["Bahia","Sevilla","Barcelona"],
    "David Batty"          : ["Leeds","Blackburn Rovers","Newcastle United","Leeds"],
    "David Beckham"        : ["Manchester United","Real Madrid","LA Galaxy","A.C. Milan","PSG"],
    "Denis Irwin"          : ["Leeds","Oldham Athletic","Manchester United","Wolverhampton Wanderers"],
    "Dennis Bergkamp"      : ["Ajax","Internazionale","Arsenal"],
    "Diego Forlán"         : ["Club Atlético Independiente","Manchester United","Villarreal CF","Atlético Madrid","Internazionale","Sport Club Internacional","Cerezo Osaka","Peñarol"],
    "Edgar Davids"         : ["Ajax","A.C. Milan","Juventus","Barcelona","Tottenham","Ajax","Crystal Palace","Barnet"],
    "Edin Džeko"           : ["Zeljeznicar","Teplice","Ústí nad Labem","VfL Wolfsburg","Manchester City","A.S. Roma"],
    "Edwin van der Sar"    : ["Ajax","Juventus","Fulham","Manchester United"],
    "Emmanuel Petit"       : ["Monaco","Arsenal","Barcelona","Chelsea"],
    "Eric Cantona"         : ["Auxerre","Martigues","Marseille","Bordeaux","Montpellier","Nimes","Leeds","Manchester United"],
    "Esteban Cambiasso"    : ["Club Atlético Independiente","River Plate","Real Madrid","Internazionale","Leicester City","Olympiacos"],
    "Ezequiel Lavezzi"     : ["Club Atlético Independiente","Genoa","San Lorenzo","Napoli","PSG"],
    "Fernando Torres"      : ["Atlético Madrid","Liverpool","Chelsea","A.C. Milan","Atlético Madrid"],
    "Frank Lampard"        : ["West Ham","Swansea City","West Ham","Chelsea","Manchester City","New York City FC"],
    "Gareth Bale"          : ["Southampton","Tottenham","Real Madrid"],
    "Gerard Pique"         : ["Manchester United","Barcelona"],
    "Graeme Le Saux"       : ["Chelsea","Blackburn Rovers","Chelsea","Southampton"],
    "Hernan Crespo"        : ["River Plate","Parma","S.S. Lazio","Internazionale","Chelsea","A.C. Milan","Internazionale","Genoa","Parma"],
    "Ian Rush"             : ["Chester City","Liverpool","Juventus","Liverpool","Leeds","Newcastle United","Wrexham","Sydney Olympic"],
    "Ian Wright"           : ["Crystal Palace","Arsenal","West Ham","Celtic","Burnley"],
    "James Milner"         : ["Leeds","Newcastle United","Aston Villa","Manchester City","Liverpool"],
    "James Rodríguez"      : ["Porto","Monaco","Real Madrid"],
    "Jermain Defoe"        : ["West Ham","Bournemouth","West Ham","Tottenham","Portsmouth","Tottenham","Toronto FC","Tottenham","Sunderland"],
    "Jonathan Walters"     : ["Blackburn Rovers","Bolton Wanderers","Hull City","Crewe Alexandra","Barnsley","Hull City","Scunthorpe United","Wrexham","Chester City","Ipswich Town","Stoke City"],
    "Jonathan Woodgate"    : ["Leeds","Newcastle United","Real Madrid","Middlesbrough","Tottenham","Stoke City","Middlesbrough"],
    "Jordan Henderson"     : ["Sunderland","Coventry","Liverpool"],
    "Jordan Rhodes"        : ["Ipswich Town","Oxford United","Rochdale","Brentford","Huddersfield Town","Blackburn Rovers"],
    "José Antonio Reyes"   : ["Sevilla","Arsenal","Real Madrid","Atlético Madrid","Benfica","Sevilla"],
    "Juan Mata"            : ["Real Madrid","Valencia","Chelsea","Manchester United"],
    "Kaká"                 : ["São Paulo FC","A.C. Milan","Real Madrid","A.C. Milan","Orlando City"],
    "Kevin De Bruyne"      : ["Genk","Chelsea","VfL Wolfsburg","Manchester City"],
    "Landon Donovan"       : ["Bayer Leverkusen","San Jose Earthquakes","LA Galaxy","Bayern Munich","LA Galaxy","Everton","LA Galaxy"],
    "Lee Tomlin"           : ["Rushden","Peterborough","Middlesbrough","Bournemouth"],
    "Luis Suárez"          : ["Nacional","Groningen","Ajax","Liverpool","Barcelona"],
    "Mario Balotelli"      : ["Lumezzane","Internazionale","Manchester City","A.C. Milan","Liverpool"],
    "Mario Gómez"          : ["Stuttgart","Bayern Munich","Fiorentina","Besiktas"],
    "Mario Götze"          : ["Borussia Dortmund","Bayern Munich"],
    "Mark Hughes"          : ["Manchester United","Barcelona","Manchester United","Chelsea","Southampton","Everton","Blackburn Rovers"],
    "Mathieu Valbuena"     : ["Libourne","Marseille","Dynamo Moscow"],
    "Mesut Özil"           : ["Schalke 04","Werder Bremen","Real Madrid","Arsenal"],
    "Michael Carrick"      : ["West Ham","Tottenham","Manchester United"],
    "Michael Owen"         : ["Liverpool","Real Madrid","Newcastle United","Manchester United","Stoke City"],
    "Miroslav Klose"       : ["FC 08 Homburg","1. FC Kaiserslautern","Werder Bremen","Bayern Munich","Lazio"],
    "Nani"                 : ["Sporting Cp","Manchester United","Sporting Cp","Fenerbahce"],
    "Nathaniel Clyne"      : ["Crystal Palace","Southampton","Liverpool"],
    "Nigel de Jong"        : ["Ajax","Hamburger SV","Manchester City","A.C. Milan"],
    "Oscar"                : ["São Paulo FC","Internacional","Chelsea"],
    "Patrick Kluivert"     : ["Ajax","A.C. Milan","Barcelona","Newcastle United","Valencia","PSV Eindhoven","Lille"],
    "Paul Ince"            : ["West Ham","Manchester United","Internazionale","Liverpool","Middlesbrough","Wolverhampton Wanderers"],
    "Pavel Nedvěd"         : ["Dukla Prague","Sparta Prague","S.S. Lazio","Juventus"],
    "Pepe Reina"           : ["Barcelona","Villarreal CF","Liverpool","Bayern Munich","Napoli"],
    "Peter Schmeichel"     : ["Gladsaxe-Hero","Hvidovre","Brondby","Manchester United","Sporting Cp","Aston Villa","Manchester City"],
    "Radamel Falcao"       : ["River Plate","Porto","Atlético Madrid","Monaco","Manchester United","Chelsea"],
    "Rafael van der Vaart" : ["Ajax","Hamburger SV","Real Madrid","Tottenham","Hamburger SV","Real Betis"],
    "Rio Ferdinand"        : ["West Ham","Bournemouth","Leeds","Manchester United","QPR"],
    "Robbie Keane"         : ["Wolverhampton Wanderers","Coventry","Internazionale","Leeds","Tottenham","Liverpool","Tottenham","Celtic","West Ham","LA Galaxy"],
    "Robert Lewandowski"   : ["Znicz Pruszkow","Lech Poznan","Borussia Dortmund","Bayern Munich"],
    "Séamus Coleman"       : ["Sligo Rovers","Everton","Blackpool","Everton"],
    "Sergio Agüero"        : ["Independiente","Atlético Madrid","Manchester City"],
    "Shay Given"           : ["Blackburn Rovers","Newcastle United","Manchester City","Aston Villa","Stoke City"],
    "Sol Campbell"         : ["Tottenham","Arsenal","Portsmouth","Notts County","Arsenal","Newcastle United"],
    "Steve McManaman"      : ["Liverpool","Real Madrid","Manchester City"],
    "Steven Gerrard"       : ["Liverpool","LA Galaxy"],
    "Stewart Downing"      : ["Middlesbrough","Aston Villa","Liverpool","West Ham","Middlesbrough"],
    "Sylvinho"             : ["Corinthians","Arsenal","Celta Vigo","Barcelona","Manchester City"],
    "_Thierry Henry"       : ["Monaco","Juventus","Arsenal","Barcelona","New York Red Bulls"],
    "Thierry Henry"        : ["West Ham","Monaco","Juventus","Arsenal","Barcelona","New York Red Bulls"],
    "Tim Cahill"           : ["Millwall","Everton","New York City FC","Shanghai Shenhua"],
    "Toni Kroos"           : ["Bayern Munich","Bayer Leverkusen","Bayern Munich","Real Madrid"],
    "Vincent Kompany"      : ["Anderlecht","Hamburger SV","Manchester City"],
    "Wesley Sneijder"      : ["Ajax","Real Madrid","Internazionale","Galatasaray"],
    "Willian"              : ["Corinthians","Shakhtar Donetsk","Anzhi Makhachkala","Chelsea"],
    "Yaya Touré"           : ["Beveren","Metalurh Donetsk","Olympiacos","Monaco","Barcelona","Manchester City"],
    "Zinedine Zidane"      : ["AS Cannes","Bordeaux","Juventus","Real Madrid"],
    "Zlatan Ibrahimović"   : ["Malmo","Ajax","Juventus","Internazionale"]
};

var clubsByPlayer           = JSON.parse(JSON.stringify(clubsByPlayerFull));
var originalTitle           = document.title;
var answerButtons           = document.getElementsByClassName("sidebar-qa-content__answers")[0].getElementsByTagName("a");
var answerOptions           = [];
var clubs                   = [];
var matches                 = [];
var answerMatches           = [];
var exhausted               = false;
var answerOptionsUpdated    = false;
//var DEBUG                   = true;

function findMatches() {
    matches = [];
    for (var player in clubsByPlayer) {
        if (clubsByPlayer.hasOwnProperty(player)) {
            playerClubs = clubsByPlayer[player];
            if (clubs.length <= playerClubs.length && JSON.stringify(playerClubs.slice(0, clubs.length)) === JSON.stringify(clubs)) {
                matches.push(player.replace(/_/g, ''));
            }
        }
    }
}

function getPlayerNameFromAnswerButtons() {
    answerOptions = [];
    for (var i = 0; i < answerButtons.length; i++) {
        answerOptions.push(answerButtons[i].firstChild.nodeValue);
    }
}

function oneMatch(match) {
    document.title = clubs + " -> " + match;

    for (var i = 0; i < answerButtons.length; i++) {
        if (match === answerButtons[i].firstChild.nodeValue) {
            answerButtons[i].click();
            delete clubsByPlayer[match];
            break;
        }
    }

    exhausted = true;
}

function findAnswerMatches() {
    answerMatches = [];
    
    for (var j = 0; j < matches.length; j++) {
        for (var i = 0; i < answerOptions.length; i++) {
            if (answerOptions[i] === matches[j]) {
                answerMatches.push(answerButtons[i]);
                break;
            }
        }
    }
}

function resetAttributes() {
    //clubsByPlayer           = JSON.parse(JSON.stringify(clubsByPlayerFull));
    document.title          = originalTitle;
    clubs                   = [];
    exhausted               = false;
    answerOptionsUpdated    = false;
}

console.log = function(msg) {
    if (msg === "adjustOpacity" || msg === "nextTransfer" || msg === "addFlightPath" || msg === "checkAnswer" ||
        /^You have answered \d+ out of \d+ correctly.$/.test(msg)) {

        return;
    }

    if (msg === "moveOn") {
        
        /*
        if (DEBUG && matches.length === 0) {

            var clubsPadded = [];
            for (var i = 0; i < clubs.length; i++) {
                clubsPadded.push('"' + clubs[i] + '"');
            }
            window.prompt("", "[" + clubsPadded + "]");

            var p = "";
            for (var i = 0; i < answerButtons.length; i++) {
                p += answerButtons[i].firstChild.nodeValue + " ";
            }
            window.prompt("", p);
        }
        */

        resetAttributes();
        return;
    }

    if (msg === "gameOver") {
        resetAttributes();
        clubsByPlayer = JSON.parse(JSON.stringify(clubsByPlayerFull));
        return;
    }

    clubs.push(msg);
    
    if(exhausted) {
        return;
    }

    findMatches();

    if (matches.length === 0) {
        exhausted = true;
        return;
    }

    if (matches.length === 1) {
        oneMatch(matches[0]);
        return;
    }

    document.title = clubs + " -> " + matches;
    
    if (!answerOptionsUpdated) {
        getPlayerNameFromAnswerButtons();
        answerOptionsUpdated = true;
    }

    findAnswerMatches();

    if (answerMatches.length === 0) {
        document.title = "No matches in answers";
        exhausted = true;
    } else if (answerMatches.length === 1) {
        var player = answerMatches[0].firstChild.nodeValue;
        document.title = clubs + " -> " + player;
        answerMatches[0].click();
        delete clubsByPlayer[player];
    }
};


//Get past start screen and instructions
document.getElementsByClassName("hex-btn play")[0].click();
document.getElementsByClassName("instructions-content__play-btn btn btn--blindroll instructions-btn center-block noselect")[0].click();